<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TinaCMS Content Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }

        .test-section {
            border: 1px solid #ddd;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
        }

        .success {
            border-color: #28a745;
            background-color: #d4edda;
        }

        .warning {
            border-color: #ffc107;
            background-color: #fff3cd;
        }

        .error {
            border-color: #dc3545;
            background-color: #f8d7da;
        }

        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }

        button:hover {
            background: #0056b3;
        }

        .log {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
            font-family: monospace;
            font-size: 12px;
        }
    </style>
</head>

<body>
    <h1>TinaCMS Content Display Test</h1>

    <div class="test-section success">
        <h2>‚úÖ Test Instructions</h2>
        <ol>
            <li><strong>Open TinaCMS Admin:</strong> <a href="/admin" target="_blank">http://localhost:5176/admin</a>
            </li>
            <li><strong>Create or Edit a Post:</strong> Add some content in the rich text editor</li>
            <li><strong>Save the Post:</strong> Make sure to save your changes</li>
            <li><strong>View the Post:</strong> Click "View Post" or navigate to the blog</li>
            <li><strong>Verify Content:</strong> Check that your content appears (not Lorem ipsum)</li>
        </ol>
    </div>

    <div class="test-section">
        <h2>üîß Quick Tests</h2>
        <button onclick="testTinaCMSConnection()">Test TinaCMS Connection</button>
        <button onclick="testGraphQLEndpoint()">Test GraphQL Endpoint</button>
        <button onclick="openAdminPanel()">Open Admin Panel</button>
        <button onclick="openBlogHomepage()">Open Blog Homepage</button>

        <div id="test-results" class="log" style="display: none;"></div>
    </div>

    <div class="test-section warning">
        <h2>‚ö†Ô∏è Common Issues & Solutions</h2>
        <ul>
            <li><strong>Empty Content:</strong> Make sure you're adding content in the TinaCMS editor, not just the
                title/excerpt</li>
            <li><strong>TinaCMS Not Loading:</strong> Ensure TinaCMS dev server is running on port 4001</li>
            <li><strong>Posts Not Showing:</strong> Check that posts are saved in <code>/public/content/posts/</code>
            </li>
            <li><strong>Console Errors:</strong> Open browser dev tools (F12) to check for errors</li>
        </ul>
    </div>

    <div class="test-section">
        <h2>üõ†Ô∏è Technical Details</h2>
        <h3>What Was Fixed:</h3>
        <ul>
            <li><strong>Content Loading:</strong> Replaced hardcoded Lorem ipsum with actual TinaCMS content</li>
            <li><strong>Body Field:</strong> Ensured <code>post.body</code> is properly fetched and displayed</li>
            <li><strong>Rich Text Support:</strong> Added support for TinaCMS rich text content</li>
            <li><strong>Fallback Handling:</strong> Added graceful fallback when content is empty</li>
        </ul>

        <h3>Content Flow:</h3>
        <ol>
            <li>Content created in TinaCMS admin ‚Üí saved to <code>.mdx</code> file</li>
            <li>GraphQL API fetches post with <code>body</code> field</li>
            <li><code>tinaDataLoader.js</code> converts TinaCMS format to blog format</li>
            <li><code>SinglePostPage.jsx</code> renders content using <code>TinaCMSContent</code> component</li>
            <li>Content displays properly on the blog</li>
        </ol>
    </div>

    <script>
        function log(message, type = 'info') {
            const results = document.getElementById('test-results');
            results.style.display = 'block';
            const timestamp = new Date().toLocaleTimeString();
            results.innerHTML += `[${timestamp}] ${message}\n`;
        }

        async function testTinaCMSConnection() {
            log('Testing TinaCMS connection...');
            try {
                const response = await fetch('http://localhost:4001/graphql', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ query: 'query { __typename }' })
                });

                if (response.ok) {
                    log('‚úÖ TinaCMS connection successful');
                } else {
                    log(`‚ùå TinaCMS connection failed: ${response.status}`);
                }
            } catch (error) {
                log(`‚ùå TinaCMS connection error: ${error.message}`);
            }
        }

        async function testGraphQLEndpoint() {
            log('Testing GraphQL posts query...');
            try {
                const response = await fetch('http://localhost:4001/graphql', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        query: `query {
                            postConnection {
                                edges {
                                    node {
                                        title
                                        body
                                        _sys { filename }
                                    }
                                }
                            }
                        }`
                    })
                });

                const data = await response.json();
                const posts = data?.data?.postConnection?.edges || [];
                log(`‚úÖ Found ${posts.length} posts`);

                posts.forEach((post, index) => {
                    const hasBody = post.node.body ? '‚úÖ' : '‚ùå';
                    log(`Post ${index + 1}: "${post.node.title}" - Body: ${hasBody}`);
                });
            } catch (error) {
                log(`‚ùå GraphQL query error: ${error.message}`);
            }
        }

        function openAdminPanel() {
            window.open('/admin', '_blank');
        }

        function openBlogHomepage() {
            window.open('/', '_blank');
        }

        // Auto-run connection test on page load
        setTimeout(testTinaCMSConnection, 1000);
    </script>
</body>

</html>